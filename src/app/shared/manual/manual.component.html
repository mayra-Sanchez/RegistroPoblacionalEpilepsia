<!-- manual.component.html -->
<div class="manual-overlay" [class.active]="isModalOpen">
  <div class="manual-container">
    <!-- Cabecera -->
    <div class="manual-header">
      <div class="header-content">
        <img src="../../assets/manual/logo.png" alt="Logo RPE" class="logo">
        <h1>Manual del Sistema RPE</h1>
      </div>
      <button class="close-btn" (click)="closeModal()" aria-label="Cerrar manual">
        <span class="material-icons">close</span>
      </button>
    </div>

    <div class="manual-body">
      <!-- Menú lateral -->
      <div class="manual-sidebar">
        <div class="search-box">
          <input type="text" id="manualSearch" placeholder="Buscar en el manual..." 
                 (keyup)="searchManual($event)" [value]="searchTerm">
          <span class="material-icons">search</span>
          <button *ngIf="searchTerm" class="clear-search" (click)="clearSearch()" 
                  title="Limpiar búsqueda">
            <span class="material-icons">clear</span>
          </button>
        </div>

        <div class="search-results-info" *ngIf="showSearchResults">
          <span class="results-count">{{searchResultsCount}} resultado(s) encontrado(s)</span>
        </div>

        <h2 class="sidebar-title">Contenido</h2>
        <ul class="section-list">
          <li *ngFor="let section of filteredSections; let i = index">
            <button class="section-btn" (click)="goToSection(i)" [class.active]="currentSection === i">
              <span class="section-icon material-icons">{{section.icon}}</span>
              {{section.title}}
            </button>
          </li>
        </ul>
      </div>

      <!-- Contenido principal -->
      <div class="manual-content">
        <div class="page" *ngFor="let page of manualSections; let i = index" 
             [class.active]="currentSection === i" [id]="'page-' + i">

          <div class="page-header">
            <div class="page-title-container">
              <span class="page-icon material-icons">{{page.icon}}</span>
              <h2>{{page.title}}</h2>
            </div>
            <h3>{{page.subtitle}}</h3>
          </div>

          <div class="page-body">
            <!-- Contenido de texto -->
            <div class="text-content">
              <p *ngFor="let paragraph of page.content" 
                 [innerHTML]="highlightText(paragraph)"></p>
            </div>

            <!-- Videos embebidos -->
            <div class="video-container" *ngIf="page.videoUrl">
              <iframe width="100%" height="400" [src]="page.videoUrl | safe:'resourceUrl'" 
                      frameborder="0" allowfullscreen></iframe>
            </div>

            <!-- Imágenes de ayuda -->
            <div class="image-help" *ngIf="page.helpImage">
              <img [src]="page.helpImage" alt="Imagen de ayuda">
              <p class="image-caption">{{page.imageCaption}}</p>
            </div>

            <!-- Contenido adicional -->
            <div class="additional-content" *ngIf="page.subtitle2">
              <h4>{{page.subtitle2}}</h4>
              <p *ngFor="let paragraph of page.content2" 
                 [innerHTML]="highlightText(paragraph)"></p>
            </div>

            <!-- Consejos prácticos -->
            <div class="tips-section" *ngIf="page.tips && page.tips.length > 0">
              <div class="section-title">
                <span class="material-icons">lightbulb</span>
                <h4>Consejos Prácticos</h4>
              </div>
              <ul class="tips-list">
                <li *ngFor="let tip of page.tips" [innerHTML]="highlightText(tip)"></li>
              </ul>
            </div>

            <!-- Notas importantes -->
            <div class="notes-section" *ngIf="page.importantNotes && page.importantNotes.length > 0">
              <div class="section-title">
                <span class="material-icons">warning</span>
                <h4>Notas Importantes</h4>
              </div>
              <ul class="notes-list">
                <li *ngFor="let note of page.importantNotes" [innerHTML]="highlightText(note)"></li>
              </ul>
            </div>

            <!-- Tablas de referencia -->
            <div class="reference-table" *ngIf="page.referenceTable">
              <div class="section-title">
                <span class="material-icons">table_chart</span>
                <h4>{{page.referenceTable.title}}</h4>
              </div>
              <table>
                <thead>
                  <tr>
                    <th *ngFor="let header of page.referenceTable.headers">{{header}}</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let row of page.referenceTable.rows">
                    <td *ngFor="let cell of row" [innerHTML]="highlightText(cell)"></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="page-footer">
            <div class="page-counter">
              Página {{ currentSection + 1 }} de {{ manualSections.length }}
            </div>
            <div class="page-actions">
              <button class="print-btn" (click)="printSection()">
                <span class="material-icons">print</span> Imprimir
              </button>
              <button class="bookmark-btn" (click)="toggleBookmark(i)" 
                      [class.bookmarked]="isBookmarked(i)">
                <span class="material-icons">{{isBookmarked(i) ? 'bookmark' : 'bookmark_border'}}</span>
                {{isBookmarked(i) ? 'Guardado' : 'Guardar'}}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Navegación -->
    <div class="manual-navigation">
      <button class="nav-btn prev-btn" (click)="prevSection()" [disabled]="currentSection === 0">
        <span class="material-icons">chevron_left</span> Anterior
      </button>
      
      <div class="navigation-info">
        <span class="current-section">{{ manualSections[currentSection]?.title }}</span>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="(currentSection + 1) / manualSections.length * 100"></div>
        </div>
      </div>
      
      <button class="nav-btn next-btn" (click)="nextSection()" 
              [disabled]="currentSection === manualSections.length - 1">
        Siguiente <span class="material-icons">chevron_right</span>
      </button>
    </div>
  </div>
</div>
<div class="user-form-container">
  <!-- Paso 1: Datos del paciente -->
  <app-paciente-form *ngIf="pasoActual === 1" [researchLayerId]="currentResearchLayerId"
    (next)="handlePacienteData($event)">
  </app-paciente-form>

  <!-- Paso 2: Datos clínicos -->
  <app-clinico-form *ngIf="pasoActual === 2" [researchLayerId]="currentResearchLayerId" [initialData]="clinicalData"
    (next)="handleClinicalData($event)" (prev)="pasoAnterior()"></app-clinico-form>

  <!-- Paso 3: Datos del cuidador -->
  <app-cuidador-form *ngIf="pasoActual === 3 && tieneCuidador" [initialData]="cuidadorData"
    (next)="handleCuidadorData($event)" (prev)="pasoAnterior()">
  </app-cuidador-form>

  <div *ngIf="pasoActual === 3 && !tieneCuidador" class="skip-step">
    <p>No se requiere información de cuidador</p>
    <button type="button" class="btn btn-next" (click)="siguientePaso()">
      Continuar <i class="fas fa-arrow-right"></i>
    </button>
  </div>

  <!-- Paso 4: Datos del profesional + Consentimiento -->
  <div *ngIf="pasoActual === 4">
    <app-profesional-form [initialData]="profesionalData" (prev)="pasoAnterior()"
      (submit)="handleProfesionalData($event)">
    </app-profesional-form>

    <!-- Sección de consentimiento informado -->
    <div class="consent-section mt-4">
      <h5>Consentimiento Informado</h5>
      <div class="alert alert-info">
        Por favor suba el documento firmado del consentimiento informado si el paciente es nuevo en el sistema
      </div>
      <app-signature-pad [isNewPatient]="true" [patientId]="pacienteData.identificationNumber" 
                        (fileUploaded)="onConsentUploaded($event)">
      </app-signature-pad>
    </div>
  </div>

  <!-- Spinner durante el envío -->
  <div *ngIf="isSending" class="loading-overlay">
    <div class="spinner"></div>
    <p>Enviando datos...</p>
  </div>
</div>
<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="header-content">
      <div class="layer-info" *ngIf="currentResearchLayer?.layerName">
        <mat-icon>layers</mat-icon>
        <div>
          <p class="layer-name">Capa actual: {{ currentResearchLayer?.layerName }}</p>
          <p class="boss-name" *ngIf="currentResearchLayer?.layerBoss?.name">
            Responsable: {{ currentResearchLayer?.layerBoss?.name }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-content">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando datos de investigación...</p>
    </div>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="errorMessage" class="error-overlay mat-elevation-z4">
    <div class="error-content">
      <mat-icon color="warn">error_outline</mat-icon>
      <div class="error-text">
        <h3>Error al cargar datos</h3>
        <p>{{ errorMessage }}</p>
      </div>
      <button mat-stroked-button color="warn" (click)="loadCurrentResearchLayer()">
        <mat-icon>refresh</mat-icon>
        Reintentar
      </button>
    </div>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!loading && !errorMessage" class="dashboard-content">
    <!-- Tarjetas resumen -->
    <div class="summary-section">
      <h2 class="section-title">Resumen Estadístico</h2>
      <div class="summary-cards">
        <mat-card *ngFor="let card of summaryCards" class="summary-card mat-elevation-z2">
          <mat-card-header>
            <mat-icon mat-card-avatar [style.background]="getCardColor(card.trend)">{{card.icon}}</mat-icon>
            <mat-card-title>{{card.title}}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="card-value">{{card.value | number}}</div>
            <div class="card-trend" [class.up]="card.trend === 'up'" 
                                  [class.down]="card.trend === 'down'">
              <mat-icon>{{card.trend === 'up' ? 'arrow_upward' : 
                         card.trend === 'down' ? 'arrow_downward' : 'remove'}}</mat-icon>
              <span>{{card.change}}%</span>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Gráficas principales -->
    <div class="charts-section">
      <h2 class="section-title">Visualización de Datos</h2>
      <div class="main-charts">
        <mat-card class="chart-card mat-elevation-z2">
          <mat-card-header>
            <mat-card-title>Distribución por Sexo</mat-card-title>
            <mat-icon>group</mat-icon>
          </mat-card-header>
          <mat-card-content>
            <canvas #chartCanvas1 baseChart [data]="chartData1" [type]="chartType1" [options]="barChartOptions">
            </canvas>
          </mat-card-content>
        </mat-card>

        <mat-card class="chart-card mat-elevation-z2">
          <mat-card-header>
            <mat-card-title>Tipos de Crisis</mat-card-title>
            <mat-icon>warning</mat-icon>
          </mat-card-header>
          <mat-card-content>
            <canvas #chartCanvas2 baseChart [data]="chartData2" [type]="chartType2" [options]="pieChartOptions">
            </canvas>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>
<div #dashboardContainer class="dashboard-container">
  <!-- Barra de controles simplificada -->
  <div class="controls-bar">
    <button mat-icon-button 
            (click)="refreshDashboard()" 
            [disabled]="isLoading" 
            matTooltip="Actualizar dashboard">
      <mat-icon>refresh</mat-icon>
    </button>

    <button mat-icon-button 
            (click)="openInNewTab()" 
            matTooltip="Abrir en nueva pestaña">
      <mat-icon>open_in_new</mat-icon>
    </button>

    <!-- Indicador de estado en línea -->
    <div class="status-info">
      <span *ngIf="isLoading" class="loading-indicator">
        <mat-spinner diameter="20"></mat-spinner>
        Cargando...
      </span>
      <span *ngIf="lastLoadTime && !isLoading" class="last-update">
        Actualizado: {{ lastLoadTime | date:'HH:mm:ss' }}
      </span>
    </div>
  </div>

  <!-- Estados de carga/error -->
  <div *ngIf="isLoading" class="loading-state">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando dashboard...</p>
  </div>

  <div *ngIf="hasError" class="error-state">
    <mat-icon color="warn">error_outline</mat-icon>
    <h3>Error al cargar</h3>
    <p>{{ errorMessage }}</p>
    <button mat-raised-button color="primary" (click)="refreshDashboard()">
      <mat-icon>refresh</mat-icon>
      Reintentar
    </button>
  </div>

  <!-- Iframe del dashboard -->
  <iframe #dashboardIframe
    [src]="dashboardUrl"
    width="100%"
    frameborder="0"
    (load)="onIframeLoad()"
    (error)="onIframeError()"
    [hidden]="!isIframeLoaded || hasError"
    class="superset-iframe"
    title="Dashboard de Superset">
  </iframe>
</div>